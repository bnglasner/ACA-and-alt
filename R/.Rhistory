# interactive Fixed Effects vs Synthetic test
# Medicaid Paper
# Ben Glasner
# 2/14/2020
library(ggplot2)
library(gsynth)
###############################################
###         Build the fake data             ###
###############################################
ids <- rep(rep(1:100,each=1),18)
years <- rep(2000:2017, each=100)
Urban <- rep(seq(0,1,by=10), each=1800) + seq(0,1)
Medicaid_expansion <- rep(rep(0:1,each=2),450)
test_data <- as.data.frame(cbind(ids,years,Urban,Medicaid_expansion))
test_data$expansion <- 0
test_data$expansion[test_data$Medicaid_expansion==1 & test_data$years>2013]<-1
test_data$recession <- 0
test_data$recession[test_data$years>2007 & test_data$years<2012] <- 1
test_data$group <-"Rural No Expansion"
test_data$group[test_data$Urban==0 & test_data$Medicaid_expansion==1] <- "Rural Expansion"
test_data$group[test_data$Urban==1 & test_data$Medicaid_expansion==0] <- "Urban No Expansion"
test_data$group[test_data$Urban==1 & test_data$Medicaid_expansion==1] <- "Urban Expansion"
test_data$estab_pop[test_data$group=="Rural No Expansion"] <- 6.03 + .005*(test_data$years[test_data$group=="Rural No Expansion"]-1999) - 0.005*test_data$recession[test_data$group=="Rural No Expansion"]
test_data$estab_pop[test_data$group=="Rural Expansion"] <- 6.04 + .004*(test_data$years[test_data$group=="Rural Expansion"]-1999) - 0.006*test_data$recession[test_data$group=="Rural Expansion"]  - 0.001*test_data$expansion[test_data$group=="Rural Expansion"]
test_data$estab_pop[test_data$group=="Urban No Expansion"] <- 6.01 + .005*(test_data$years[test_data$group=="Urban No Expansion"]-1999) - 0.005*test_data$recession[test_data$group=="Urban No Expansion"]
test_data$estab_pop[test_data$group=="Urban Expansion"] <- 6.02 + .004*(test_data$years[test_data$group=="Urban Expansion"]-1999) - 0.004*test_data$recession[test_data$group=="Urban Expansion"] - 0.002*test_data$expansion[test_data$group=="Urban Expansion"]
test_data$estab_pop_err <- jitter(test_data$estab_pop)
ggplot(data = test_data,
aes(x = years, y = estab_pop_err, group = group, color = group, linetype = group)) +
geom_smooth()
###############################################
###         Build the fake Uber data        ###
###############################################
ids <- rep(1:100,each=1)
Urban <- rep(seq(0,1,by=10), each=100) + seq(0,1)
Uber_year <- as.data.frame(cbind(ids,Urban))
View(Uber_year)
set.seed(989898)
Uber_start_year <- runif(100, 1, 6) + 2011
sample(c(1, 2, 3), size = 100, replace = TRUE, prob = c(0.1, 0.5, 0.4))
sample(c(0,1, 2, 3, 4, 5, 6), size = 500, replace = TRUE, prob = c(.3, .05, .05, .2, .2, .1, .1))
sample(c(0,1, 2, 3, 4, 5, 6), size = 50, replace = TRUE, prob = c(.3, .05, .05, .2, .2, .1, .1))
rural_uber <- sample(c(0,1, 2, 3, 4, 5, 6), size = 50, replace = TRUE, prob = c(.3, .05, .05, .2, .2, .1, .1)) + 2011
urban_uber <- sample(c(0, 1, 2, 3, 4, 5, 6), size = 50, replace = TRUE, prob = c(.1, .1, .1, .4, .1, .1, .1)) + 2011
Urban <- rep(0, each=50)
ids <- rep(1:50, each =1)
###############################################
###         Build the fake Uber data        ###
###############################################
uber <- sample(c(0, 1, 2, 3, 4, 5, 6), size = 50, replace = TRUE, prob = c(.3, .05, .05, .2, .2, .1, .1)) + 2011
Urban <- rep(0, each=50)
ids <- rep(1:50, each =1)
Uber_year_rural <- as.data.frame(cbind(ids,Urban,uber))
View(Uber_year_rural)
odd <- seq(1, by=2, len=100)
odd <- seq(1, by=2, len=50)
seq(0,100,2)
even <- seq(0,100,2)
even <- seq(1,100,2)
even <- seq(2,100,2)
even
# interactive Fixed Effects vs Synthetic test
# Medicaid Paper
# Ben Glasner
# 2/14/2020
library(ggplot2)
library(gsynth)
set.seed(989898)
uber <- sample(c(0, 1, 2, 3, 4, 5, 6), size = 50, replace = TRUE, prob = c(.3, .05, .05, .2, .2, .1, .1)) + 2011
Urban <- rep(0, each=50)
ids <- seq(1, by=2, len=50)
Uber_year_rural <- as.data.frame(cbind(ids,Urban,uber))
View(Uber_year_rural)
uber <- sample(c(0, 1, 2, 3, 4, 5, 6), size = 50, replace = TRUE, prob = c(.1, .1, .1, .4, .1, .1, .1)) + 2011
Urban <- rep(1, each=50)
ids <- seq(2,100,2)
Uber_year_urban <- as.data.frame(cbind(ids,Urban,uber))
View(Uber_year_urban)
uber_data <- rbind(Uber_year_rural,Uber_year_urban)
View(uber_data)
ids <- rep(rep(1:100,each=1),18)
years <- rep(2000:2017, each=100)
Urban <- rep(seq(0,1,by=10), each=1800) + seq(0,1)
Medicaid_expansion <- rep(rep(0:1,each=2),450)
test_data <- as.data.frame(cbind(ids,years,Urban,Medicaid_expansion))
View(test_data)
View(uber_data)
library(dplyr)
View(uber_data)
uber_data <- uber_data %>% dplyr::select("ids","uber")
View(uber_data)
# interactive Fixed Effects vs Synthetic test
# Medicaid Paper
# Ben Glasner
# 2/14/2020
library(ggplot2)
library(gsynth)
library(dplyr)
set.seed(989898)
###############################################
###         Build the fake Uber data        ###
###############################################
uber_year <- sample(c(0, 1, 2, 3, 4, 5, 6), size = 50, replace = TRUE, prob = c(.3, .05, .05, .2, .2, .1, .1)) + 2011
Urban <- rep(0, each=50)
ids <- seq(1, by=2, len=50)
Uber_year_rural <- as.data.frame(cbind(ids,Urban,uber))
uber_year <- sample(c(0, 1, 2, 3, 4, 5, 6), size = 50, replace = TRUE, prob = c(.1, .1, .1, .4, .1, .1, .1)) + 2011
Urban <- rep(1, each=50)
ids <- seq(2,100,2)
Uber_year_urban <- as.data.frame(cbind(ids,Urban,uber))
uber_data <- rbind(Uber_year_rural,Uber_year_urban)
uber_data <- uber_data %>% dplyr::select("ids","uber")
uber_year <- sample(c(0, 1, 2, 3, 4, 5, 6), size = 50, replace = TRUE, prob = c(.3, .05, .05, .2, .2, .1, .1)) + 2011
Urban <- rep(0, each=50)
ids <- seq(1, by=2, len=50)
Uber_year_rural <- as.data.frame(cbind(ids,Urban,uber_year))
uber_year <- sample(c(0, 1, 2, 3, 4, 5, 6), size = 50, replace = TRUE, prob = c(.1, .1, .1, .4, .1, .1, .1)) + 2011
Urban <- rep(1, each=50)
ids <- seq(2,100,2)
Uber_year_urban <- as.data.frame(cbind(ids,Urban,uber_year))
uber_data <- rbind(Uber_year_rural,Uber_year_urban)
uber_data <- uber_data %>% dplyr::select("ids","uber")
View(uber_data)
uber_data <- uber_data %>% dplyr::select("ids","uber_year")
rm(Uber_year_rural, Uber_year_urban)
ids <- rep(rep(1:100,each=1),18)
years <- rep(2000:2017, each=100)
Urban <- rep(seq(0,1,by=10), each=1800) + seq(0,1)
Medicaid_expansion <- rep(rep(0:1,each=2),450)
test_data <- as.data.frame(cbind(ids,years,Urban,Medicaid_expansion))
test_data <- merge(test_data,uber_data)
test_data$expansion <- 0
test_data$expansion[test_data$Medicaid_expansion==1 & test_data$years>2013]<-1
View(test_data)
uber_data$uber_year[uber_data$uber_year<2012] <- 0
ids <- rep(rep(1:100,each=1),18)
years <- rep(2000:2017, each=100)
Urban <- rep(seq(0,1,by=10), each=1800) + seq(0,1)
Medicaid_expansion <- rep(rep(0:1,each=2),450)
test_data <- as.data.frame(cbind(ids,years,Urban,Medicaid_expansion))
test_data <- merge(test_data,uber_data)
View(test_data)
test_data$expansion <- 0
test_data$expansion[test_data$Medicaid_expansion==1 & test_data$years>2013]<-1
test_data$recession <- 0
test_data$recession[test_data$years>2007 & test_data$years<2012] <- 1
test_data$Uber_active <- 0
test_data$Uber_active[test_data$uber_year==test_data$years] <- 1
View(test_data)
test_data$Uber_active[test_data$uber_year<test_data$years] <- 1
View(test_data)
# interactive Fixed Effects vs Synthetic test
# Medicaid Paper
# Ben Glasner
# 2/14/2020
library(ggplot2)
library(gsynth)
library(dplyr)
set.seed(989898)
###############################################
###         Build the fake Uber data        ###
###############################################
uber_year <- sample(c(0, 1, 2, 3, 4, 5, 6), size = 50, replace = TRUE, prob = c(.3, .05, .05, .2, .2, .1, .1)) + 2011
Urban <- rep(0, each=50)
ids <- seq(1, by=2, len=50)
Uber_year_rural <- as.data.frame(cbind(ids,Urban,uber_year))
uber_year <- sample(c(0, 1, 2, 3, 4, 5, 6), size = 50, replace = TRUE, prob = c(.1, .1, .1, .4, .1, .1, .1)) + 2011
Urban <- rep(1, each=50)
ids <- seq(2,100,2)
Uber_year_urban <- as.data.frame(cbind(ids,Urban,uber_year))
uber_data <- rbind(Uber_year_rural,Uber_year_urban)
uber_data <- uber_data %>% dplyr::select("ids","uber_year")
rm(Uber_year_rural, Uber_year_urban)
uber_data$uber_year[uber_data$uber_year<2012] <- 0
###############################################
###         Build the fake data             ###
###############################################
ids <- rep(rep(1:100,each=1),18)
years <- rep(2000:2017, each=100)
Urban <- rep(seq(0,1,by=10), each=1800) + seq(0,1)
Medicaid_expansion <- rep(rep(0:1,each=2),450)
test_data <- as.data.frame(cbind(ids,years,Urban,Medicaid_expansion))
test_data <- merge(test_data,uber_data)
test_data$expansion <- 0
test_data$expansion[test_data$Medicaid_expansion==1 & test_data$years>2013]<-1
test_data$recession <- 0
test_data$recession[test_data$years>2007 & test_data$years<2012] <- 1
test_data$Uber_active <- 0
test_data$Uber_active[test_data$uber_year==test_data$years] <- 1
test_data$Uber_active[test_data$uber_year<test_data$years] <- 1
test_data$group <-"Rural No Expansion"
test_data$group[test_data$Urban==0 & test_data$Medicaid_expansion==1] <- "Rural Expansion"
test_data$group[test_data$Urban==1 & test_data$Medicaid_expansion==0] <- "Urban No Expansion"
test_data$group[test_data$Urban==1 & test_data$Medicaid_expansion==1] <- "Urban Expansion"
test_data$estab_pop[test_data$group=="Rural No Expansion"] <- 6.03 + .005*(test_data$years[test_data$group=="Rural No Expansion"]-1999) - 0.005*test_data$recession[test_data$group=="Rural No Expansion"] + 0.001*test_data$Uber_active[test_data$group=="Rural No Expansion"]
test_data$estab_pop[test_data$group=="Rural Expansion"] <- 6.04 + .004*(test_data$years[test_data$group=="Rural Expansion"]-1999) - 0.006*test_data$recession[test_data$group=="Rural Expansion"]  - 0.001*test_data$expansion[test_data$group=="Rural Expansion"] + 0.001*test_data$Uber_active[test_data$group=="Rural Expansion"]
test_data$estab_pop[test_data$group=="Urban No Expansion"] <- 6.01 + .005*(test_data$years[test_data$group=="Urban No Expansion"]-1999) - 0.005*test_data$recession[test_data$group=="Urban No Expansion"] + 0.001*test_data$Uber_active[test_data$group=="Urban No Expansion"]
test_data$estab_pop[test_data$group=="Urban Expansion"] <- 6.02 + .004*(test_data$years[test_data$group=="Urban Expansion"]-1999) - 0.004*test_data$recession[test_data$group=="Urban Expansion"] - 0.002*test_data$expansion[test_data$group=="Urban Expansion"] + 0.001*test_data$Uber_active[test_data$group=="Urban Expansion"]
test_data$estab_pop_err <- jitter(test_data$estab_pop)
ggplot(data = test_data,
aes(x = years, y = estab_pop_err, group = group, color = group, linetype = group)) +
geom_smooth()
inter_fe_estab0 <- interFE(estab_pop_err ~
expansion,
data = test_data, index=c("ids","years"),
force = "two-way", nboots = 100, se = TRUE)
gsynth1 <- gsynth(Y = "estab_pop_err",
D = "expansion",
data = test_data,
index = c("ids","years"),
force = "two-way",
CV = TRUE,
se = TRUE,
estimator = "mc",
nlambda = 10,
inference = "nonparametric",
nboots = 300,
parallel = TRUE,
cores =4)
print(gsynth1)
View(test_data)
# interactive Fixed Effects vs Synthetic test
# Medicaid Paper
# Ben Glasner
# 2/14/2020
library(ggplot2)
library(gsynth)
library(dplyr)
set.seed(989898)
###############################################
###         Build the fake Uber data        ###
###############################################
uber_year <- sample(c(0, 1, 2, 3, 4, 5, 6), size = 50, replace = TRUE, prob = c(.3, .05, .05, .2, .2, .1, .1)) + 2011
Urban <- rep(0, each=50)
ids <- seq(1, by=2, len=50)
Uber_year_rural <- as.data.frame(cbind(ids,Urban,uber_year))
uber_year <- sample(c(0, 1, 2, 3, 4, 5, 6), size = 50, replace = TRUE, prob = c(.1, .1, .1, .4, .1, .1, .1)) + 2011
Urban <- rep(1, each=50)
ids <- seq(2,100,2)
Uber_year_urban <- as.data.frame(cbind(ids,Urban,uber_year))
uber_data <- rbind(Uber_year_rural,Uber_year_urban)
uber_data <- uber_data %>% dplyr::select("ids","uber_year")
rm(Uber_year_rural, Uber_year_urban)
uber_data$uber_year[uber_data$uber_year<2012] <- 0
###############################################
###         Build the fake data             ###
###############################################
ids <- rep(rep(1:100,each=1),18)
years <- rep(2000:2017, each=100)
Urban <- rep(seq(0,1,by=10), each=1800) + seq(0,1)
Medicaid_expansion <- rep(rep(0:1,each=2),450)
test_data <- as.data.frame(cbind(ids,years,Urban,Medicaid_expansion))
test_data <- merge(test_data,uber_data)
test_data$expansion <- 0
test_data$expansion[test_data$Medicaid_expansion==1 & test_data$years>2013]<-1
test_data$recession <- 0
test_data$recession[test_data$years>2007 & test_data$years<2012] <- 1
test_data$Uber_active <- 0
test_data$Uber_active[test_data$uber_year==test_data$years] <- 1
test_data$Uber_active[test_data$uber_year<test_data$years] <- 1
test_data$group <-"Rural No Expansion"
test_data$group[test_data$Urban==0 & test_data$Medicaid_expansion==1] <- "Rural Expansion"
test_data$group[test_data$Urban==1 & test_data$Medicaid_expansion==0] <- "Urban No Expansion"
test_data$group[test_data$Urban==1 & test_data$Medicaid_expansion==1] <- "Urban Expansion"
test_data$estab_pop[test_data$group=="Rural No Expansion"] <- 6.03 + .005*(test_data$years[test_data$group=="Rural No Expansion"]-1999) - 0.005*test_data$recession[test_data$group=="Rural No Expansion"] + 0.02*test_data$Uber_active[test_data$group=="Rural No Expansion"]
test_data$estab_pop[test_data$group=="Rural Expansion"] <- 6.04 + .004*(test_data$years[test_data$group=="Rural Expansion"]-1999) - 0.006*test_data$recession[test_data$group=="Rural Expansion"]  - 0.02*test_data$expansion[test_data$group=="Rural Expansion"] + 0.001*test_data$Uber_active[test_data$group=="Rural Expansion"]
test_data$estab_pop[test_data$group=="Urban No Expansion"] <- 6.01 + .005*(test_data$years[test_data$group=="Urban No Expansion"]-1999) - 0.005*test_data$recession[test_data$group=="Urban No Expansion"] + 0.02*test_data$Uber_active[test_data$group=="Urban No Expansion"]
test_data$estab_pop[test_data$group=="Urban Expansion"] <- 6.02 + .004*(test_data$years[test_data$group=="Urban Expansion"]-1999) - 0.004*test_data$recession[test_data$group=="Urban Expansion"] - 0.02*test_data$expansion[test_data$group=="Urban Expansion"] + 0.001*test_data$Uber_active[test_data$group=="Urban Expansion"]
test_data$estab_pop_err <- jitter(test_data$estab_pop)
ggplot(data = test_data,
aes(x = years, y = estab_pop_err, group = group, color = group, linetype = group)) +
geom_smooth()
# interactive Fixed Effects vs Synthetic test
# Medicaid Paper
# Ben Glasner
# 2/14/2020
library(ggplot2)
library(gsynth)
library(dplyr)
set.seed(989898)
###############################################
###         Build the fake Uber data        ###
###############################################
uber_year <- sample(c(0, 1, 2, 3, 4, 5, 6), size = 50, replace = TRUE, prob = c(.3, .05, .05, .2, .2, .1, .1)) + 2011
Urban <- rep(0, each=50)
ids <- seq(1, by=2, len=50)
Uber_year_rural <- as.data.frame(cbind(ids,Urban,uber_year))
uber_year <- sample(c(0, 1, 2, 3, 4, 5, 6), size = 50, replace = TRUE, prob = c(.1, .1, .1, .4, .1, .1, .1)) + 2011
Urban <- rep(1, each=50)
ids <- seq(2,100,2)
Uber_year_urban <- as.data.frame(cbind(ids,Urban,uber_year))
uber_data <- rbind(Uber_year_rural,Uber_year_urban)
uber_data <- uber_data %>% dplyr::select("ids","uber_year")
rm(Uber_year_rural, Uber_year_urban)
uber_data$uber_year[uber_data$uber_year<2012] <- 0
###############################################
###         Build the fake data             ###
###############################################
ids <- rep(rep(1:100,each=1),18)
years <- rep(2000:2017, each=100)
Urban <- rep(seq(0,1,by=10), each=1800) + seq(0,1)
Medicaid_expansion <- rep(rep(0:1,each=2),450)
test_data <- as.data.frame(cbind(ids,years,Urban,Medicaid_expansion))
test_data <- merge(test_data,uber_data)
test_data$expansion <- 0
test_data$expansion[test_data$Medicaid_expansion==1 & test_data$years>2013]<-1
test_data$recession <- 0
test_data$recession[test_data$years>2007 & test_data$years<2012] <- 1
test_data$Uber_active <- 0
test_data$Uber_active[test_data$uber_year==test_data$years] <- 1
test_data$Uber_active[test_data$uber_year<test_data$years] <- 1
test_data$group <-"Rural No Expansion"
test_data$group[test_data$Urban==0 & test_data$Medicaid_expansion==1] <- "Rural Expansion"
test_data$group[test_data$Urban==1 & test_data$Medicaid_expansion==0] <- "Urban No Expansion"
test_data$group[test_data$Urban==1 & test_data$Medicaid_expansion==1] <- "Urban Expansion"
test_data$estab_pop[test_data$group=="Rural No Expansion"] <- 6.03 + .005*(test_data$years[test_data$group=="Rural No Expansion"]-1999) - 0.005*test_data$recession[test_data$group=="Rural No Expansion"] + 0.02*test_data$Uber_active[test_data$group=="Rural No Expansion"]
test_data$estab_pop[test_data$group=="Rural Expansion"] <- 6.04 + .004*(test_data$years[test_data$group=="Rural Expansion"]-1999) - 0.006*test_data$recession[test_data$group=="Rural Expansion"]  - 0.001*test_data$expansion[test_data$group=="Rural Expansion"] + 0.02*test_data$Uber_active[test_data$group=="Rural Expansion"]
test_data$estab_pop[test_data$group=="Urban No Expansion"] <- 6.01 + .005*(test_data$years[test_data$group=="Urban No Expansion"]-1999) - 0.005*test_data$recession[test_data$group=="Urban No Expansion"] + 0.02*test_data$Uber_active[test_data$group=="Urban No Expansion"]
test_data$estab_pop[test_data$group=="Urban Expansion"] <- 6.02 + .004*(test_data$years[test_data$group=="Urban Expansion"]-1999) - 0.004*test_data$recession[test_data$group=="Urban Expansion"] - 0.002*test_data$expansion[test_data$group=="Urban Expansion"] + 0.02*test_data$Uber_active[test_data$group=="Urban Expansion"]
test_data$estab_pop_err <- jitter(test_data$estab_pop)
ggplot(data = test_data,
aes(x = years, y = estab_pop_err, group = group, color = group, linetype = group)) +
geom_smooth()
View(test_data)
inter_fe_estab0 <- interFE(estab_pop_err ~
expansion,
data = test_data, index=c("ids","years"),
force = "two-way", nboots = 100, se = TRUE)
gsynth1 <- gsynth(Y = "estab_pop_err",
D = "expansion",
data = test_data,
index = c("ids","years"),
force = "two-way",
CV = TRUE,
se = TRUE,
estimator = "mc",
nlambda = 10,
inference = "nonparametric",
nboots = 300,
parallel = TRUE,
cores =4)
print(gsynth1)
plot(gsynth1,
type = "gap",
xlab = "Period",
theme.bw = TRUE)
plot(gsynth1,
type = "counterfactual",
xlab = "Period",
theme.bw = TRUE)
inter_fe_estab0 <- interFE(estab_pop_err ~
expansion*Urban,
data = test_data, index=c("ids","years"),
force = "two-way", nboots = 100, se = TRUE)
test_data$expansion_urban <- test_data$expansion*test_data$Urban
inter_fe_estab0 <- interFE(estab_pop_err ~
expansion + expansion_urban,
data = test_data, index=c("ids","years"),
force = "two-way", nboots = 100, se = TRUE)
inter_fe_estab0 <- interFE(estab_pop_err ~
expansion*Uber_active +
expansion_urban + ,
data = test_data, index=c("ids","years"),
force = "two-way", nboots = 100, se = TRUE)
inter_fe_estab0 <- interFE(estab_pop_err ~
expansion*Uber_active +
expansion_urban,
data = test_data, index=c("ids","years"),
force = "two-way", nboots = 100, se = TRUE)
inter_fe_estab0 <- interFE(estab_pop_err ~
expansion +
expansion_urban,
data = test_data, index=c("ids","years"),
force = "two-way", nboots = 100, se = TRUE)
gsynth1 <- gsynth(Y = "estab_pop_err",
D = "expansion",
data = subset(test_data,Urban==1),
index = c("ids","years"),
force = "two-way",
CV = TRUE,
se = TRUE,
estimator = "mc",
nlambda = 10,
inference = "nonparametric",
nboots = 300,
parallel = TRUE,
cores =4)
print(gsynth1)
gsynth1 <- gsynth(Y = "estab_pop_err",
D = "expansion",
data = subset(test_data,Urban==0),
index = c("ids","years"),
force = "two-way",
CV = TRUE,
se = TRUE,
estimator = "mc",
nlambda = 10,
inference = "nonparametric",
nboots = 300,
parallel = TRUE,
cores =4)
print(gsynth1)
inter_fe_estab0 <- interFE(estab_pop_err ~
expansion,
data = test_data, index=c("ids","years"),
force = "two-way", nboots = 100, se = TRUE)
inter_fe_estab1 <- interFE(estab_pop_err ~
expansion,
data = subset(test_data,Urban==1), index=c("ids","years"),
force = "two-way", nboots = 100, se = TRUE)
inter_fe_estab2 <- interFE(estab_pop_err ~
expansion,
data = subset(test_data,Urban==0), index=c("ids","years"),
force = "two-way", nboots = 100, se = TRUE)
